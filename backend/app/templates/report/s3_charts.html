{# PATCH: backend/app/templates/report/s3_charts.html
   
   PROBLEM: Po sekcji wykresu dobowego jest stary blok HTML legendy
   z błędnymi kolorami (#27AE60, #F39C12, #E74C3C, #2980B9).
   
   Legenda jest teraz WBUDOWANA w obrazek PNG (fig.legend na dole figury).
   Stary blok HTML legendy musi być USUNIĘTY żeby nie duplikować.
   
   ZNAJDŹ i USUŃ cały blok (między <!-- Legenda --> a </div> po nim):

    <!-- Legenda -->
    <div style="display:flex; gap:16px; margin-top:10px; flex-wrap:wrap;">
        <div style="display:flex; align-items:center; gap:5px;">
            <div style="width:12px; height:12px; background:#27AE60; border-radius:2px;"></div>
            <span style="font-size:11px; color:var(--gray-600);">Autokonsumpcja PV</span>
        </div>
        <div style="display:flex; align-items:center; gap:5px;">
            <div style="width:12px; height:12px; background:#F39C12; border-radius:2px;"></div>
            <span style="font-size:11px; color:var(--gray-600);">Nadwyżka do sieci</span>
        </div>
        <div style="display:flex; align-items:center; gap:5px;">
            <div style="width:12px; height:12px; background:#E74C3C; border-radius:2px;"></div>
            <span style="font-size:11px; color:var(--gray-600);">Pobór z sieci</span>
        </div>
        <div style="display:flex; align-items:center; gap:5px;">
            <div style="width:14px; height:3px; background:#2980B9; border-radius:2px;"></div>
            <span style="font-size:11px; color:var(--gray-600);">Zużycie domu</span>
        </div>
    </div>

   GOTOWY fragment s3_charts.html po WYKRESIE DOBOWYM (zastąp cały blok karty):
#}

<!-- ─── WYKRES 3: Dobowy przepływ energii ───────────────────────────────── -->
<div class="card avoid-break" style="padding: 16px 20px;">

    <div style="font-size: 11px; font-weight: 700; text-transform: uppercase;
                letter-spacing: .05em; color: var(--c-primary); margin-bottom: 10px;">
        Dobowy przepływ energii — przykładowy dzień (lato vs. zima)
    </div>

    {% if charts and charts.daily_flow %}
        <img src="data:image/png;base64,{{ charts.daily_flow }}"
             alt="Dobowy przepływ energii"
             style="width: 100%; border-radius: 8px; display: block;">
        {# Legenda jest wbudowana w obrazek PNG przez fig.legend() — nie duplikujemy #}
    {% else %}
        <div style="background: var(--gray-50); border: 1px dashed var(--gray-300);
                    border-radius: 10px; padding: 20px; text-align: center;">
            <p class="text-sm text-muted" style="margin: 0; line-height: 1.6;">
                Wykres dobowy niedostępny — brak danych godzinowych w tej symulacji.<br>
                Produkcja roczna:
                <strong class="text-accent">{{ standard.annual_production_kwh | round | int }} kWh</strong>
                · Autokonsumpcja:
                <strong>{{ (standard.autoconsumption_rate * 100) | round | int }}%</strong>
            </p>
        </div>
        {# Fallback: manualna legenda gdy brak wykresu #}
        <div style="display:flex; gap:16px; margin-top:10px; flex-wrap:wrap;">
            <div style="display:flex; align-items:center; gap:5px;">
                <div style="width:12px; height:12px; background:#D4AC0D; border-radius:2px;"></div>
                <span style="font-size:11px; color:var(--gray-600);">Produkcja PV</span>
            </div>
            <div style="display:flex; align-items:center; gap:5px;">
                <div style="width:12px; height:12px; background:#E57373; border-radius:2px;"></div>
                <span style="font-size:11px; color:var(--gray-600);">Pobór z sieci</span>
            </div>
            <div style="display:flex; align-items:center; gap:5px;">
                <div style="width:12px; height:12px; background:#2E86C1; border-radius:2px;"></div>
                <span style="font-size:11px; color:var(--gray-600);">Zużycie domu</span>
            </div>
            <div style="display:flex; align-items:center; gap:5px;">
                <div style="width:12px; height:12px; background:#66BB6A; border-radius:2px;"></div>
                <span style="font-size:11px; color:var(--gray-600);">Ładowanie bat.</span>
            </div>
            <div style="display:flex; align-items:center; gap:5px;">
                <div style="width:12px; height:12px; background:#A78BFA; border-radius:2px;"></div>
                <span style="font-size:11px; color:var(--gray-600);">Rozładowanie bat.</span>
            </div>
        </div>
    {% endif %}

</div>